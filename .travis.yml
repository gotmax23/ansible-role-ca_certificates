---
sudo: required
language: python
services: docker

env:
  - version=">=2.7,<2.8" distro="alpine-latest"
  - version="" distro="alpine-latest"
  - version="devel" distro="alpine-latest"
  - version=">=2.7,<2.8" distro="alpine-edge"
  - version="" distro="alpine-edge"
  - version="devel" distro="alpine-edge"
  - version=">=2.7,<2.8" distro="archlinux"
  - version="" distro="archlinux"
  - version="devel" distro="archlinux"
  - version=">=2.7,<2.8" distro="centos-7"
  - version="" distro="centos-7"
  - version="devel" distro="centos-7"
  - version=">=2.7,<2.8" distro="centos-latest"
  - version="" distro="centos-latest"
  - version="devel" distro="centos-latest"
  - version=">=2.7,<2.8" distro="debian-stable"
  - version="" distro="debian-stable"
  - version="devel" distro="debian-stable"
  - version=">=2.7,<2.8" distro="debian-unstable"
  - version="" distro="debian-unstable"
  - version="devel" distro="debian-unstable"
  - version=">=2.7,<2.8" distro="fedora-latest"
  - version="" distro="fedora-latest"
  - version="devel" distro="fedora-latest"
  - version=">=2.7,<2.8" distro="fedora-rawhide"
  - version="" distro="fedora-rawhide"
  - version="devel" distro="fedora-rawhide"
  - version=">=2.7,<2.8" distro="opensuse-leap"
  - version="" distro="opensuse-leap"
  - version="devel" distro="opensuse-leap"
  - version=">=2.7,<2.8" distro="ubuntu-rolling"
  - version="" distro="ubuntu-rolling"
  - version="devel" distro="ubuntu-rolling"
  - version=">=2.7,<2.8" distro="ubuntu-latest"
  - version="" distro="ubuntu-latest"
  - version="devel" distro="ubuntu-latest"
  - version=">=2.7,<2.8" distro="ubuntu-devel"
  - version="" distro="ubuntu-devel"
  - version="devel" distro="ubuntu-devel"

matrix:
  allow_failures:
    - env: version=">=2.7,<2.8" distro="alpine-edge"
    - env: version="" distro="alpine-edge"
    - env: version="devel" distro="alpine-edge"
    - env: version="devel" distro="alpine-latest"
    - env: version="devel" distro="archlinux"
    - env: version="devel" distro="centos-7"
    - env: version="devel" distro="centos-latest"
    - env: version="devel" distro="debian-stable"
    - env: version=">=2.7,<2.8" distro="debian-unstable"
    - env: version="" distro="debian-unstable"
    - env: version="devel" distro="debian-unstable"
    - env: version="devel" distro="fedora-latest"
    - env: version=">=2.7,<2.8" distro="fedora-rawhide"
    - env: version="" distro="fedora-rawhide"
    - env: version="devel" distro="fedora-rawhide"
    - env: version="devel" distro="opensuse-leap"
    - env: version="devel" distro="ubuntu-rolling"
    - env: version=">=2.7,<2.8" distro="ubuntu-devel"
    - env: version="" distro="ubuntu-devel"
    - env: version="devel" distro="ubuntu-devel"
    - env: version="devel" distro="ubuntu-latest"

cache:
  - pip

install:
  - pip install --upgrade pip
  - if [ "${version}" != "devel" ] ; then pip install ansible"${version}" ; fi
  - if [ "${version}" = "devel" ] ; then pip install git+https://github.com/ansible/ansible.git@devel ; fi
  - pip install molecule
  - pip install docker

script:
  - if [ "${expectation}" = "fail" ] ; then ! molecule test --scenario-name "${distro}" ; else molecule test --scenario-name "${distro}" ; fi

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    secure: "eH9MAc8tldnzS2WzWkGhPGKqsfv+T2ySqBuNfvp5iimU5JT6uqTiCyfQHYl8m3TkKHnFsLNv+dMgaeBowf/EyFKQJx0IlBU7WENHZF31/DxL2BwuTzURl7qutpYx5WrwEtAPw7Ld0x7pDRFcSS++U8nXbZC/D//TTAUvo9bt//jDPwTWEr3K9hvM2qRgQsHxFx1WtHggWw/H0hfl5n3jAoyXVNpv4wy6Bkhanz0RM1/9g/Sx7frv7TBdO77vpUjhM9ATzpFpLUrh3mMk+rhdN1YGS+wzh5VkjgMKoiEWe+neG6zi9Epxx5C1107ajWQ4C43UIcMuqHtSZ+aIZYKN0S6OQZ1erv2Dy9FB1D2NlTU25H/1KTxsLaAoga4E93b2Mlpf2nGPq4p2xBLcfZ9E3nXSzJrdOdQI7kFM1qtVVrnmAL4pxYoc41741iZDwlcH4UdYOtYwEl8rOJdQamMd0iBcoEpBGqR+cKV8hagk3DH10un9jyBgGAq3V0XAf85R3lIu4w35ksTtr5qo4h9qaI0Pl639tlIIEYgvfy8ytSvXoHIRMz29wh8tCNuyXEO7OwkZJRTxjYNzGWLFa1ztPdbfsnuzSlDKZNYwDYRsNTIdnT8MuAsfse8gcpUHWVjNokWGGMTT8gXinNqtsjDBgnC5HDW+jXNb7Ad4ACyJnpQ="

  email: false
